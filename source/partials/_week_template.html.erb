<% url_for_section = url_host + url_prefix + (slug == "week-0" ? '/' : slug) %>
<% page_title = doc.detect{|row| row.kind == "page_title"}.try(:title) || '' %>
<% share_text = doc.detect{|row| row.kind == "share_text"}.try(:text) || default_share_text %>

<article class="<%= slug == active_slug ? 'active' : 'hidden' %>"
         data-slug="<%=slug%>"
         data-index="<%=index%>"
         data-url-for-section="<%=url_for_section%>"
         data-page-title= "<%= page_title %>"
         data-share-text= "<%= share_text %>" >

  <%# ---- Video ----------------------------- #%>
  <% video_row = doc.detect{|row| row.kind == "video"} %>
  <% if video_row.present? %>
  <section class="lede video slider single">
    <ul class="videos">
      <li class="active">
        <button class="overlay" style="background-image: url('<%= video_row.image %>')">
          <h1><%= video_row.title %></h1>
          <svg class="play-icon" viewBox="0 0 100 100"><use xlink:href="#play-button"></use></svg>
        </button>
        <div class="video-container" id="video-container-<%= index %>" data-video-index="<%= index %>" data-video-id="<%=video_row.text %>"></div>
      </li>
    </ul>

    <div id="navigation">
      <%# --- Navigation -- -%>
      <a href="#" class="prev">
        <svg class="prev" viewBox="0 0 30 126"><use xlink:href="#prev-arrow"></use></svg>
      </a>
      <a href="#" class="next">
      <svg class="next" viewBox="0 0 30 126"><use xlink:href="#next-arrow"></use></svg>
      </a>
    </div>
  </section>
  <% end %>

  <%# ---- Content --- %>
  <section class="content container">
  <%# Get the share text of out this week %>
  <%= partial 'partials/social_share', :locals => {:share_text => share_text,
                                                   :share_url =>  url_for_section} %>
    <% doc.each do |row| %>
      <% if row.kind == "impression" && row.image.present? %>
        <img class="pixel-tracker" data-src="<%= row.image %>" />
      <% elsif row.kind == "text" %>
        <%= partial 'partials/kind_text', :locals => {:row => row} %>
      <% elsif row.kind.to_s.end_with?('_quote') %>
        <%= partial 'partials/kind_quote', :locals => {:row => row} %>
      <% elsif (row.kind == "left" || row.kind == "image" || row.kind == "right" || row.kind == "overlay" || row.kind == "divider") %>
        <% if row.link.present?
          markdown_syntax_link = /\[([^\]]+)\]\(([^)]+)\)/.match(row.link.to_s)
          if(!markdown_syntax_link.nil? && markdown_syntax_link.size == 3) # this is markdown syntax!
            link_title = markdown_syntax_link[1]
            link_href =  markdown_syntax_link[2]
          else
            link_title = "Read more about " + row.title.to_s + "..."
            link_href = row.link.to_s
          end
          %>
          <a href="<%= link_href %>">
        <% end %>
        <figure class="<%= row.kind %>">
          <% if row.image.present? %>
            <img src="<%= row.image %>" alt=" ">
          <% end %>
          <div class="figure-content">
            <% if row.title.present? %>
              <h3><%= row.title %></h3>
            <% end %>
            <% if row.text.present? %>
              <p><%= row.text %></p>
            <% end %>
            <% if row.link.present? %>
              <div class="action">
                <svg class="inline-icon" viewBox="0 0 100 100"><use xlink:href="#play-button"></use></svg>
                <%= link_title %>
              </div>
            <% end %>
          </div>
        </figure>
        <%= "</a>" if row.link.present? %>
      <% end %>
    <% end %>
  </section>

  <footer class="footer">
      <a href="http://voxmedia.com"> <svg class="footer__logo vox-logo" viewBox="0 0 200 72"><use xlink:href="#vox-logo"></use></svg></a>
      <aside class="footer__text">
        <p>This feature was produced in collaboration between <a href="http://www.voxmedia.com/media-kit/brand/vox-creative">VOX Creative</a> and <%= sponsor_name %>. The Verge editorial staff was not involved in the creation or production of this content.</p>
        <small>&copy;<%= Time.new.year %>. Vox Media, Inc. All Rights Reserved</small>
      </aside>
  </footer>
</article>
