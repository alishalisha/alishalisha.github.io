<%# Loop through all the weeks and build them here -- %>
<% active_slug ||= slugs.first
  weeks ||= locals[:weeks] || []

  # used for carousel at the bottom of the index page ------
  videos = []
  weeks.each_with_index do |week_data, index|
    videos << {:image => week_data.detect{|row| row.kind == "video"}.fetch("image"),
               :text =>  week_data.detect{|row| row.kind == "text"}.fetch("title"),
               :slug => "week-#{index}"}
  end
  # --------------------------------------------------------
%>

<% weeks.each_with_index do |week_data, index| %>
  <% slug = slugs.at(index) %>
  <%= partial "partials/week_template", :locals => {:doc => week_data,
                                                    :active_slug => active_slug,
                                                    :slug => slug,
                                                    :index => index,
                                                    :published_videos => videos
                                                    } %>
<% end %>
